1. Remove the approval lock for Prepare Visa stage so we can move the deals anywhere as well

2. Can we have the send retainer agreement and send invoice and cost button on any stage on the top down button menu?

Also the pricing is excluding tax or including? If it's excluding tax, we need to make sure the rounding is done correctly. We have all the inclusive of tax price

Also noticed that when we send the retainer agreement etc. The deal owner is not getting the notification to resign the agreement but me



//---------------- Getting a record from Deals Module --------------//
// deal_data = zoho.crm.getRecordById("Deals",deal_id);
// // info deal_data;
// today_date = zoho.currentdate;
// date_convert = toDate(today_date,"dd-MMM-yyyy");
// full_name2 = deal_data.get("Contact_Name").get("name");
// address = deal_data.get("Address_onshore");
// city = deal_data.get("City_onshore");
// zip = deal_data.get("Zipcode_onshore");
// country = deal_data.get("Country_onshore");
// telephone = deal_data.get("Mobile");
// mobile = deal_data.get("Mobile");
// email = deal_data.get("Email");
// reference = deal_data.get("Unique_Identifier");
// //
// //--------------- GET ZOHOSIGN TEMPLATE BY ID -------------------//
// template_fields = zoho.sign.getTemplateById("3524000000073035");
// info template_fields;
// // fetching recipitants "role and action_id"
// res = template_fields.get("templates").get("actions");
// for each  var in res
// {
// 	info "these are role:" + var.get("role");
// 	info "these are actionID: " + var.get("action_id");
// 	info "-----";
// }
// // create actionMap
// actionMap = Map();
// // storing values in keys of template fields using fieldTextData map. (e.g "Our Reference" is template field label(key) and it stores a reference(value)) //
// fieldTextData = Map();
// fieldTextData.put("Our Reference",reference);
// // fieldTextData.put("Today date",date_convert);
// fieldTextData.put("Full name",full_name2);
// fieldTextData.put("Address",address + " " + "Zip:" + zip + city + " " + country);
// fieldTextData.put("Telephone",telephone);
// fieldTextData.put("Mobile",mobile);
// fieldTextData.put("Email",email);
// fieldTextData.put("Facsimile","testing facsimile");
// // fieldTextData.put("Facsimile","");
// // Now Insert fieldTextData map in actionMap. //
// actionMap.put("field_data",{"field_text_data":fieldTextData});
// // Inserting first recipetant data in eachActionMap1 //
// eachActionMap1 = Map();
// eachActionMap1.put("recipient_name",deal_data.get("Contact_Name").getJSON("name"));
// eachActionMap1.put("recipient_email",deal_data.get("Email"));
// eachActionMap1.put("action_type","SIGN");
// eachActionMap1.put("action_id","3524000000073056");
// eachActionMap1.put("role","Contact");
// eachActionMap1.put("verify_recipient","false");
// // Inserting second recipetant data in eachActionMap2 //
// eachActionMap2 = Map();
// eachActionMap2.put("recipient_name","testAL");
// eachActionMap2.put("recipient_email","miansherry62@gmail.com");
// eachActionMap2.put("action_type","SIGN");
// eachActionMap2.put("action_id","3524000000073058");
// eachActionMap2.put("role","User");
// eachActionMap2.put("verify_recipient","false");
// // Now insert both recipetants map in fieldList //
// fieldList = List();
// fieldList.add(eachActionMap1);
// fieldList.add(eachActionMap2);
// // Now Insert fieldList in actionMap. //
// actionMap.put("actions",fieldList);
// // Now Insert actionMap in submitMap //
// submitMap = Map();
// submitMap.put("templates",actionMap);
// // Here put sumbitMap in parameters //
// parameters = Map();
// parameters.put("is_quicksend","true");
// parameters.put("data",submitMap);
// info parameters;
// // Now pass parameters in createUsingTemplate //
// response = zoho.sign.createUsingTemplate("3524000000073035",parameters);
// info "this is response: " + response;
// ******************* OLD CODE
deal_det = zoho.crm.getRecordById("Deals",id);
contact_id = deal_det.get("Contact_Name").get("id");
contact_dets = zoho.crm.getRecordById("Contacts",contact_id);
student_email = contact_dets.get("Email");
contact_name = contact_dets.get("Full_Name");
// info "contact_name" + contact_name;
// info "student_email: " + student_email;
// ---  Retainer agreement --- //
contact_name = contact_dets.get("Full_Name");
contact_phone = contact_dets.get("Phone");
contact_mobile = contact_dets.get("Mobile");
contact_email = contact_dets.get("Email");
today_date = zoho.currentdate;
date_convert = toDate(today_date,"dd-MMM-yyyy");
full_name2 = contact_dets.get("Full_Name");
telephone = contact_dets.get("Phone");
mobile = contact_dets.get("Mobile");
email = contact_dets.get("Email");
address = deal_det.get("Address_onshore");
city = deal_det.get("City_onshore");
zip = deal_det.get("Zipcode_onshore");
country = deal_det.get("Country_onshore");
reference = deal_det.get("Unique_Identifier");
template_fields = zoho.sign.getTemplateById("3524000000073035");
res = template_fields.get("templates").get("actions");
actionMap = Map();
fieldTextData = Map();
fieldTextData.put("Our Reference",reference);
fieldTextData.put("Full name",full_name2);
fieldTextData.put("Address",address + " " + "Zip:" + zip + city + " " + country);
fieldTextData.put("Telephone",telephone);
fieldTextData.put("Mobile",mobile);
fieldTextData.put("Email",email);
fieldTextData.put("Facsimile"," ");
actionMap.put("field_data",{"field_text_data":fieldTextData});
eachActionMap1 = Map();
eachActionMap1.put("recipient_name",full_name2);
eachActionMap1.put("recipient_email",email);
eachActionMap1.put("action_type","SIGN");
eachActionMap1.put("action_id","3524000000073056");
eachActionMap1.put("role","Contact");
eachActionMap1.put("verify_recipient","false");
eachActionMap2 = Map();
eachActionMap2.put("recipient_name","testALL");
// jonathan.lim@kingsbridgeaustralia.com.au
eachActionMap2.put("recipient_email","jonathan.lim@kingsbridgeaustralia.com.au");
eachActionMap2.put("action_type","SIGN");
eachActionMap2.put("action_id","3524000000073058");
eachActionMap2.put("role","User");
eachActionMap2.put("verify_recipient","false");
fieldList = List();
fieldList.add(eachActionMap1);
fieldList.add(eachActionMap2);
actionMap.put("actions",fieldList);
submitMap = Map();
submitMap.put("templates",actionMap);
parameters = Map();
parameters.put("is_quicksend","true");
parameters.put("data",submitMap);
// Now pass parameters in createUsingTemplate //
response = zoho.sign.createUsingTemplate("3524000000073035",parameters);
info response;
templatedata = template_fields.get("templates");
templatename = template_fields.get("templates").get("template_name");
requests = response.get("requests");
docs = requests.get("document_ids");
info docs;
docinfo = docs.get(0);
docid = docinfo.get("document_id");
info docid;
reqid = requests.get("request_id");
recordmap = Map();
recordmap.put("Name",templatename);
recordmap.put("zohosign_Contact",id);
recordmap.put("zohosign__Owner",deal_det.get("Owner").getJSON("id"));
recordmap.put("zohosign__Deal",id);
recordmap.put("zohosign__Date_Sent",today);
recordmap.put("zohosign__ZohoSign_Document_ID",docid);
recordmap.put("zohosign__Document_Deadline",today.addDay(5));
recordmap.put("zohosign__Document_Status","Out for Signature");
recordmap.put("Check_Date",today.addDay(1));
recordmap.put("Frequency",0);
recordmap.put("Request_ID",reqid);
create = zoho.crm.createRecord("zohosign__ZohoSign_Documents",recordmap);
info "Retainer Agreement Sent!" + create;
